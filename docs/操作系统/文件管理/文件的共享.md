

**文件共享**是指多个用户可以同时访问同一个文件，而系统只保留该文件的一个副本。这种方式不仅节省了辅存和主存空间，还减少了I/O操作次数，提升了用户体验和系统资源利用率。

## 文件共享的实现方法

文件共享的实现通常采用以下几种方法：

### 目录链接法

**目录链接法**是在树形目录结构中，当多个用户需要访问同一个文件时，在各自的用户文件目录表中为共享文件建立目录项（即链接）。目录项保存指向共享文件的指针。

**特点**：

- **树状目录变为网状目录**：多个用户的目录项可以指向同一个共享文件。
- **查找路径不唯一**：用户通过不同路径都可以访问共享文件。
- **可能的问题**：
    - **删除异常**：用户删除自己的目录项时，文件并不会实际被删除，除非所有用户都删除了该目录项。
    - **更新异常**：共享文件被任一用户修改后，所有用户访问的内容都会发生变化。



### 索引结点链接法

**索引结点链接法**是通过文件系统中的**索引结点**来实现共享。每个文件都有一个索引结点，包含文件的元数据（如存储地址、文件长度等）。目录项中只存储文件名和指向该文件索引结点的指针。

**共享实现**：

- **共享用户**的目录项指向同一个索引结点。
- **链接计数器（count）**：每个索引结点有一个计数器，记录当前链接到该结点的目录项个数。
- **删除操作**：当用户删除文件时，仅删除其目录项，并减少索引结点的计数器；只有当计数器为 0 时，文件的实际数据才会被删除。

**优点**：

- 共享文件时无需复制文件内容，节省存储空间。
- 统一管理文件的元数据，便于维护和修改。



### 符号链接法

**符号链接法**是通过创建一个**符号链接文件（Symbolic Link）**来实现共享。在这种方法下，系统调用过程 `link` 用于为共享文件创建一个新的符号链接文件，并记录在用户的目录项中。符号链接文件包含目标文件的路径。

**优点**：

- **避免指针悬空**：符号链接记录的是目标文件的路径，而不是文件实际数据块的指针，因此不会出现指针悬空问题。
- **跨文件系统共享**：符号链接可以实现网络环境下的任意文件共享。

**缺点**：

- **系统开销增加**：系统需要管理符号链接文件及其路径信息。
- **占用辅存空间**：符号链接文件会占用少量的辅存空间。



## 各种文件共享方法的比较

| 方法         | 优点                                       | 缺点                                    |
|--------------|--------------------------------------------|-----------------------------------------|
| 目录链接法   | 共享文件无需复制，节省存储空间               | 目录结构变为网状，路径不唯一，易出现异常 |
| 索引结点链接法 | 统一管理元数据，链接计数器避免文件误删       | 仅限于同一文件系统，无法跨文件系统共享   |
| 符号链接法   | 跨文件系统共享，避免指针悬空                 | 增加系统开销，占用辅存空间               |

